<!doctype html>
<html lang="en" dir="ltr">

<head>
    <!--Meta Tags-->
    <%- include ('../commons/meta-tags.ejs') %>

        <!-- Title -->
        <title>Success.</title>

        <!-- Bootstrap Css -->
        <link id="style" href="/static/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

        <!-- Dashboard Css -->
        <link href="/static/css/style.css" rel="stylesheet" />
        <link href="/static/css/dark-style.css" rel="stylesheet" />
        <link href="/static/css/transparent-style.css" rel="stylesheet" />

        <!-- Font-awesome  Css -->
        <link href="/static/css/icons.css" rel="stylesheet" />

        <!--Select2 Plugin -->
        <link href="/static/plugins/select2/select2.min.css" rel="stylesheet" />

        <!-- Custom scroll bar css-->
        <link href="/static/plugins/pscrollbar/pscrollbar.css" rel="stylesheet" />

        <!-- COLOR-SKINS -->
        <link id="theme" rel="stylesheet" type="text/css" media="all"
            href="/static/color-skins/color-skins/color10.css" />
        <link rel="stylesheet" href="/static/color-skins/demo.css" />

</head>
<style>
    #tran {
        display: none;
    }

    #merchant {
        display: none;
    }
</style>

<body>

    <!--Loader-->
    <%- include ('../commons/loader.ejs') %>

        <!--Header Section-->
        <%- include ('../commons/header.ejs') %>
            <!--Header Section-->

            <!--Sliders Section-->
            <section>
                <div class="bannerimg cover-image bg-background3" data-image-src="/static/images/banners/banner1.jpg">
                    <div class="header-text mb-0">
                        <div class="container">
                            <div class="text-center text-white ">
                                <h1 class="">Application Submitted Successfully.</h1>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!--/Sliders Section-->

            <!--Forgot password-->
            <div class="sptb">
                <div class="container">
                    <!-- Page -->
                    <div id="app">
                        <div class="page-content z-index-10">
                            <div class="container text-center">
                                <div class="h2 mb-3">Your Registration Number Is: <%=registrationNumber%>
                                </div>
                                <p>Payable Fee: Rs. <b>
                                        <%=amount /100%>
                                    </b></p>

                                <%if(advRefNo=='##'){%>
                                    <%if(amount> 0){%>
                                        <div class="h2 mb-3">Click Below button to Make Payment.</div>
                                        <br><br>
                                        <div id="initatePaymentForm">
                                        </div>
                                        <!-- <a class="btn btn-primary" href="#" id="rzp-button1" onclick="intiatePayment()">
                                            To Complete Registration Make Payment
                                        </a> -->
                                        <%} else {%>
                                            <p>You do not have to pay any fee. Please click below button to Complete
                                                registration.</p>
                                            <a href="#" class="btn btn-success" onclick="complete()">
                                                Complete Registration
                                            </a>
                                            <%}%>

                                                <%}%>


                            </div>
                        </div>
                    </div>

                    <div id="payment" style="display: none;">
                        <div class="page-content z-index-10">
                            <div class="container text-center">
                                <div class="h2 mb-3">Your Registration Number Is: <%=registrationNumber%>
                                </div>
                                <br><br><br><br>
                                <div class="h2 mb-3 success" id="statusId"></div>
                                <br><br>
                                <p class="h4 font-weight-normal mb-7 leading-normal" id='razorpay_payment_id'></p>
                                <p class="h4 font-weight-normal mb-7 leading-normal" id='razorpay_order_id'></p>
                                <p class="h4 font-weight-normal mb-7 leading-normal" id='razorpay_signature'></p>
                                <p></p>
                            </div>
                        </div>
                    </div>

                    <div id="paymentNoAmt" style="display: none;">
                        <div class="page-content z-index-10">
                            <div class="container text-center">
                                <div class="h2 mb-3">Submitted Successfully.</div>
                                <br><br>
                                <p>Your Registration Number Is: <%=registrationNumber%>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div id="printFormBtn" style="display: none;">
                        <div class="page-content z-index-10">
                            <div class="container text-center">
                                <a href="/print-application-form?application_id=<%=applicationId%>"
                                    class="btn btn-success">
                                    Print Application Form
                                </a>
                                <br>
                                <p style="color:red; padding-top:30px;">NOTE: Print and keep this form as a reference
                                    and don't send the hard copy to the institution.</p>
                            </div>
                        </div>
                    </div>
                    <!-- End Page -->
                </div>
            </div>
            <!--/Forgot password-->

            <!--Footer Section-->
            <%- include ('../commons/footer.ejs') %>
                <!--Footer Section-->

                <!-- Back to top -->
                <a href="#top" id="back-to-top"><i class="fa fa-arrow-up"></i></a>

                <!-- JQuery js-->
                <script src="/static/js/vendors/jquery.min.js"></script>

                <!-- Bootstrap js -->
                <script src="/static/plugins/bootstrap/js/popper.min.js"></script>
                <script src="/static/plugins/bootstrap/js/bootstrap.min.js"></script>

                <!--JQuery Sparkline Js-->
                <script src="/static/js/vendors/jquery.sparkline.min.js"></script>

                <!-- Circle Progress Js-->
                <script src="/static/js/vendors/circle-progress.min.js"></script>

                <!--Horizontal Menu-->
                <script src="/static/plugins/horizontal/horizontal-menu/horizontal.js"></script>

                <!--Owl Carousel js -->
                <script src="/static/plugins/owl-carousel/owl.carousel.js"></script>
                <script src="/static/js/owl-carousel.js"></script>

                <!--JQuery TouchSwipe js-->
                <script src="/static/js/jquery.touchSwipe.min.js"></script>

                <!-- sticky Js-->
                <script src="/static/js/sticky.js"></script>

                <!--Select2 js -->
                <script src="/static/plugins/select2/select2.full.min.js"></script>
                <script src="/static/js/select2.js"></script>

                <!-- Cookie js -->
                <script src="/static/plugins/cookie/jquery.ihavecookies.js"></script>
                <script src="/static/plugins/cookie/cookie.js"></script>

                <!-- Custom scroll bar Js-->
                <script src="/static/plugins/pscrollbar/pscrollbar.js"></script>

                <!-- Swipe Js-->
                <script src="/static/js/swipe.js"></script>

                <!-- Scripts Js-->
                <script src="/static/js/scripts2.js"></script>

                <!-- Custom Js-->
                <script src="/static/js/themecolors.js"></script>
                <script src="/static/js/custom.js"></script>

                <!-- <script src="https://checkout.razorpay.com/v1/checkout.js"></script> -->
                <%if(amount> 0){%>
                    <script>
                        $(document).ready(function () {
                            intiatePayment(); // Call the function when the page is ready
                        });

                        function intiatePayment() {
                            console.log('<% amount %>', 'amount============')
                            const amountTotal = '<% amount/100 %>' ;
                            $.ajax({
                                type: 'POST',
                                url: `/api/sbiepay/payment/initiate`,
                                data: {
                                    application_id: '<%=applicationId%>',
                                    registration_number: '<%=registrationNumber%>',
                                    amount: '<%= amount %>'
                                },
                                success: function (htmlForm) {
                                    // Append the HTML form to a container
                                    $('#initatePaymentForm').html(htmlForm);
                                },
                                error: function (error) {
                                    console.error(error);
                                },
                            })
                            // .done(function (apiRes) {
                            //     console.log(apiRes, 'Api response================')
                            //     if (apiRes.success) {
                            //         $('#statusId').html(`Payment Success!`);
                            //         $('#razorpay_payment_id').html(`Your Payment Id: ${response.razorpay_payment_id}`);
                            //         $('#razorpay_order_id').html(`Your Order Id: ${response.razorpay_order_id}`);
                            //         $('#razorpay_signature').html(`Signature Id: ${response.razorpay_signature}`);
                            //         $('#app').hide();
                            //         $('#payment').show();
                            //         $('#printFormBtn').show();
                            //     } else {
                            //         alert(`Error! ${apiRes.msg}`)
                            //     }
                            // })
                        }
                    </script>
                    <%} else {%>
                        <script>
                            // console.log(amount, 'amount false===============')
                            function complete() {
                                $.ajax({
                                    type: 'POST',
                                    url: `/application/payment/verification`,
                                    data: {
                                        application_id: '<%=applicationId%>',
                                        registration_number: '<%=registrationNumber%>',
                                        skipAmount: true
                                    }
                                })
                                    .done(function (apiRes) {
                                        if (apiRes.success) {
                                            $('#app').hide();
                                            $('#paymentNoAmt').show();
                                            $('#printFormBtn').show();
                                        } else {
                                            alert(`Error! ${apiRes.msg}`)
                                        }
                                    })
                            }
                        </script>
                        <%}%>

</body>

</html>