<!doctype html>
<html lang="en" dir="ltr">
	<head>
		<!--Meta Tags-->
		<%- include ('../commons/meta-tags.ejs') %>

		<!-- Title -->
		<title>AIIMS Raebareli Management - <%=elligibilityStatus%> Applicants list Of <%=advRefNo%> </title>
		<link rel="stylesheet" href="/static/fonts/fonts/font-awesome.min.css">

		<!-- Bootstrap Css -->
		<link id="style" href="/static/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

		<!-- Dashboard Css -->
		<link href="/static/css/style.css" rel="stylesheet" />
		<link href="/static/css/dark-style.css" rel="stylesheet" />
	    <link href="/static/css/transparent-style.css" rel="stylesheet" />
		<link href="/static/css/admin-custom.css" rel="stylesheet" />

		<!-- c3.js Charts Plugin -->
		<link href="/static/plugins/charts-c3/c3-chart.css" rel="stylesheet" />

		<!-- DATA TABLE CSS -->
		<link href="/static/plugins/datatable/css/dataTables.bootstrap5.css" rel="stylesheet" />
		<link href="/static/plugins/datatable/css/buttons.bootstrap5.min.css" rel="stylesheet">

		<!-- Slect2 css -->
		<link href="/static/plugins/select2/select2.min.css" rel="stylesheet" />

		<!-- p-scroll bar css-->
		<link href="/static/plugins/pscrollbar/pscrollbar.css" rel="stylesheet" />

		<!---Font icons-->
		<link href="/static/css/icons.css" rel="stylesheet"/>

		<!-- WYSIWYG Editor css -->
		<link href="/static/plugins/wysiwyag/richtext.css" rel="stylesheet" />

		<!-- Color-Skins -->
		<link id="theme" rel="stylesheet" type="text/css" media="all" href="/static/color-skins/color-skins/color10.css" />
		<link rel="stylesheet" href="/static/color-skins/demo.css"/>
	</head>
		<body class="app sidebar-mini">


		<!--Loader-->
		<%- include ('loader.ejs') %>

		<div class="page">
			<div class="page-main">

				<!-- app-header---->
				<%- include ('header.ejs') %>
				<!-- app-header End---->

				<!-- Sidebar menu-->
				<%- include ('sidebar-menu.ejs') %>

				<div class="app-content">
					<div class="side-app">
						<div class="page-header">
							<h4 class="page-title"><%=elligibilityStatus%> Applicants</h4>
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="javascript:void(0);">Applicants</a></li>
								<li class="breadcrumb-item active" aria-current="page"><%=elligibilityStatus%> Applicants</li>
							</ol>

						</div>
						<div class="row">
							<div class="col-md-12 col-lg-12">
								<div class="card">
									<div class="card-header">
										<div class="card-title"><span class="text-right"><a class="btn btn-light btn-sm" href="/management/applicants/by/advertisement"><i class="fa fa-arrow-left" ></i> Back</a></span>  &nbsp; &nbsp; &nbsp;<%=elligibilityStatus%> Applicants list Of <%=advRefNo%>
											
										</div>

									</div> 
									<div class="card-body">
										<%if(elligibilityStatus!=='INELIGIBLE'){%> 
										<button class="btn btn-primary btn-sm mb-1" data-bs-toggle="modal" data-bs-target="#assignAdmitCardModel" ><i class="fa fa-check" ></i> Assign Admit Card</button>
										<button class="btn btn-warning btn-sm mb-1" data-bs-toggle="modal" data-bs-target="#assignInterviewLetter"><i class="fa fa-check" ></i> Assign Interview Letter</button>
										<button class="btn btn-success btn-sm mb-1" data-bs-toggle="modal" data-bs-target="#downloadAttendanceSheet"><i class="fa fa-check" ></i> Attendance Sheet</button>
										<%}%>
										<button class="btn btn-info btn-sm mb-1" data-bs-toggle="modal" data-bs-target="#sendEmailModel"><i class="fa fa-check" ></i> Send Mail</button>
									
										
									
										<div class="table-responsive">
											<table id="example2" class="table hover table-bordered" >
												<thead>
													<tr>
														<th>
															<input type="checkbox" value="true" onclick="selectAll(this)">Select All
														</th>
														<th>Registration Number</th>
														<th>Roll Number</th>
														<th>Name</th>
														<th>Email</th>
														<th>Mobile</th>
														<th>Department</th>
														<th>Post</th>
														<th>Paid Amount</th>
														<th>Payment Id</th>
														<th>View</th>
													</tr>
												</thead>
												<tbody>
													<%for(let i = 0; i < data.length; i++) {%>
													<tr>
														<td>
															<input class="elligibleCandidatesCheckBoxes" type="checkbox" name="elligibleCandidatesIds" value="<%=data[i]._id%>">
														</td>
														<td><%=data[i].registrationNumber%></td>
														<td><%=data[i].rollNumber?data[i].rollNumber:'Not Generated'%></td>
														<td><%=data[i].applicantName%></td>
														<td><%=data[i].applicantEmail%></td>
														<td><%=data[i].applicantMobile%></td>
														<td><%=data[i].department%></td>
														<td><%=data[i].post%></td>
														<td><i class="fa fa-inr" aria-hidden="true"></i> <%=data[i].applicationfee%></td>
														<td><%=data[i].razorpay_payment_id%></td>
														<td>
															<a href="/management/view-applicant-form?application_id=<%=data[i]._id%>" class="btn btn-primary btn-sm mb-1" target="_blank" > View Form</a>
															<%if(data[i].admitCardGenerated){%>
															<a href="/management/view-applicant-admit-card?application_id=<%=data[i]._id%>" class="btn btn-success btn-sm mb-1" target="_blank" > Admit Card</a>
															<%}%>
														</td>
													</tr>
													<%}%>
												</tbody>
											</table>

										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- FOOTER -->
			<%- include ('footer.ejs') %>
			<!-- FOOTER END -->

		</div>
		<!-- Message Modal -->
		<div class="modal fade" id="assignAdmitCardModel" tabindex="-1" role="dialog"  aria-hidden="true">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="assignAdmitCardModel">Generate Admit Card</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form id="admitCardForm">
						<div class="modal-body">
							<div class="mb-3">
								<label for="examDateTime" class="form-label">Exam Report Date & Time:</label>
								<input type="datetime-local" id="examDateTime" class="form-control" name="examDateTime" required>
							</div>

							<div class="mb-3">
								<label for="examDateTime" class="form-label">Exam Start Date & Time:</label>
								<input type="datetime-local" id="examStartDateTime" class="form-control" name="examStartDateTime" required>
							</div>

							<div class="mb-3">
								<label for="examDateTime" class="form-label">Exam End Date & Time:</label>
								<input type="datetime-local" id="examEndDateTime" class="form-control" name="examEndDateTime" required>
							</div>
							
							<div class="mb-3">
								<label for="examAddress" class="form-label">Exam Address:</label>
								<textarea id="examAddress" class="form-control" name="examAddress" required></textarea>
							</div>
							<div class="mb-3">
								<label for="examNotifications" class="form-label">Instructions For Candidates:</label>
								<textarea class="form-control" id="examNotifications" name="examNotifications"></textarea>
							</div>
						</div>
						<div class="modal-footer text-center">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-success">Generate Admit & Assign</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!-- Interview Modal -->
		<div class="modal fade" id="assignInterviewLetter" tabindex="-1" role="dialog"  aria-hidden="true">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="assignInterviewLetter">Generate Interview Letter</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form id="interviewLetterForm">
						<div class="modal-body">
							<div class="mb-3">
								<label for="interviewDateTime" class="form-label">Interview Date & Time:</label>
								<input type="datetime-local" id="interviewDateTime" class="form-control" name="interviewDateTime" required>
							</div>
							
							<div class="mb-3">
								<label for="interviewAddress" class="form-label">Interview Address:</label>
								<textarea class="form-control" id="interviewAddress" name="interviewAddress" required></textarea>
							</div>
							<div class="mb-3">
								<label for="interviewNotifications" class="form-label">Instructions For Candidates:</label>
                                <textarea class="form-control" id="interviewNotifications" name="interviewNotifications"></textarea>
							</div>
						</div>
						<div class="modal-footer text-center">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-success">Generate Interview Letter & Assign</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!-- Attendance Sheet Modal -->
		<div class="modal fade" id="downloadAttendanceSheet" tabindex="-1" role="dialog"  aria-hidden="true">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="downloadAttendanceSheet">Download Attendance Sheet</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<%
						var appliedPost = [];
						var appliedDept = [];
						for(let i = 0; i < data.length; i++) {
							if(appliedPost.indexOf(data[i].post) < 0){
								appliedPost.push(data[i].post);
							}
                            if(appliedDept.indexOf(data[i].department) < 0){
								appliedDept.push(data[i].department);
							}
						}
					%>
					<!-- <form method="post" action="/management/applicants/download-attendance-sheet"> -->
						<div class="modal-body">
							<div class="mb-3">
								<label class="form-label">Select Post</label>
								<select class="required form-control border-bottom-0 w-100" id="post" name="post" required >
									<option value="">Select Post</option>
									<%for(let i = 0; i < appliedPost.length; i++) {%>
                                    <option><%=appliedPost[i]%></option>
                                    <%}%>
								</select>
								<label class="form-label">Select Department</label>
								<select class="required form-control border-bottom-0 w-100" id="department" name="department" required >
									<option value="">Select Department</option>
									<%for(let i = 0; i < appliedDept.length; i++) {%>
									<option><%=appliedDept[i]%></option>
									<%}%>
								</select>
							</div>
						</div>
						<div class="modal-footer text-center">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="button" onclick="generateDownloadUrl()" class="btn btn-success">Download Attendance Sheet</button>
						</div>
					<!-- </form> -->
				</div>
			</div>
		</div>
		<!-- Email Modal -->
		<div class="modal fade" id="sendEmailModel" tabindex="-1" role="dialog"  aria-hidden="true">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="sendEmailModel">Send Email</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form id="sendMailForm">
						<div class="modal-body">
							<div class="mb-3">
								<label for="emailTitle" class="form-label">Email Subject:</label>
								<input type="text" id="emailSubject" class="form-control" name="emailSubject" required>
							</div>
							<div class="mb-3">
								<label for="emailContents" class="form-label">Email Body</label>
								<textarea class="form-control content" id="emailBody" name="emailBody" required></textarea>
							</div>
						</div>
						<div class="modal-footer text-center">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-success">Send Email</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		
		<!-- Back to top -->
		<a href="#top" id="back-to-top"><i class="fa fa-rocket"></i></a>


		<!-- Dashboard js -->
		<script src="/static/js/vendors/jquery.min.js"></script>
		<script src="/static/plugins/bootstrap/js/popper.min.js"></script>
		<script src="/static/plugins/bootstrap/js/bootstrap.min.js"></script>
		<script src="/static/js/vendors/selectize.min.js"></script>
		<script src="/static/js/vendors/circle-progress.min.js"></script>
		<script src="/static/plugins/rating/jquery.rating-stars.js"></script>

		<!-- Fullside-menu Js-->
		<script src="/static/plugins/toggle-sidebar/sidemenu.js"></script>

		<!-- DATA TABLE JS-->
		<script src="/static/plugins/datatable/js/jquery.dataTables.min.js"></script>
		<script src="/static/plugins/datatable/js/dataTables.bootstrap5.js"></script>
		<script src="/static/plugins/datatable/js/dataTables.buttons.min.js"></script>
		<script src="/static/plugins/datatable/js/buttons.bootstrap5.min.js"></script>
		<script src="/static/plugins/datatable/js/jszip.min.js"></script>
		<script src="/static/plugins/datatable/pdfmake/pdfmake.min.js"></script>
		<script src="/static/plugins/datatable/pdfmake/vfs_fonts.js"></script>
		<script src="/static/plugins/datatable/js/buttons.html5.min.js"></script>
		<script src="/static/plugins/datatable/js/buttons.print.min.js"></script>
		<script src="/static/plugins/datatable/js/buttons.colVis.min.js"></script>
		<script src="/static/plugins/datatable/dataTables.responsive.min.js"></script>
		<script src="/static/plugins/datatable/responsive.bootstrap5.min.js"></script>
		<script src="/static/js/datatable.js"></script>

		<!-- Select2 js -->
		<script src="/static/plugins/select2/select2.full.min.js"></script>

		<!-- p-scroll bar Js-->
		<script src="/static/plugins/pscrollbar/pscrollbar.js"></script>
		<script src="/static/plugins/pscrollbar/pscroll.js"></script>

	 <!-- sticky Js-->
		<script src="/static/js/sticky-1.js"></script>

		<!--Counters -->
		<script src="/static/plugins/counters/counterup.min.js"></script>
		<script src="/static/plugins/counters/waypoints.min.js"></script>
		<script src="/static/plugins/counters/numeric-counter.js"></script>

		<!-- WYSIWYG Editor js -->
		<script src="/static/plugins/wysiwyag/jquery.richtext.js"></script>
		<script src="/static/js/formeditor.js"></script>

		<!-- Custom Js-->
		<script src="/static/js/admin-custom.js"></script>
		<script src="/static/js/themecolors.js"></script>

		<script>
			function selectAll(value){
				if($(value).is(":checked")){
					$(".elligibleCandidatesCheckBoxes").prop('checked', true);
				} else {
					$(".elligibleCandidatesCheckBoxes").prop('checked', false);
				}
			}

			$("#admitCardForm").on('submit', function(e){
				e.preventDefault();
				let examDateTime = $('#examDateTime').val();
				let examAddress = $('#examAddress').val();
				let examNotifications = $('#examNotifications').val();
				let examStartDateTime = $('#examStartDateTime').val();
				let examEndDateTime = $('#examEndDateTime').val();
				let selectedApplicantsId = $.map($('.elligibleCandidatesCheckBoxes:checked'), function(e,i) {
					return e.value;
				});
				$.ajax({
					type: 'post',
					url: `/management/applicants/generate-admit-card`,
					data: {
						examDateTime,
						examAddress,
						examNotifications,
						selectedApplicantsId,
						examStartDateTime,
						examEndDateTime
					}
				})
				.done(function(response) {

					if(response.success){
						alert(response.msg);
						location.reload();
					} else {
						alert(response.msg);
					}
				})
			})

			function generateDownloadUrl(){
				let post = $('#post').val();
				if(!post || !post.length){
					alert('Please select post.');
					return false;
				}
				let department = $('#department').val();
				if(!department || !department.length){
					alert('Please select department.');
					return false;
				}
				let url = `/management/download-attendence-sheet?advRefNo=<%=advRefNo%>&post=${post}&department=${department}`;
				// alert(url);
				window.open(url, '_blank');
			}
				
			$("#interviewLetterForm").on('submit', function(e){
				e.preventDefault();
				let interviewDateTime = $('#interviewDateTime').val();
				let interviewAddress = $('#interviewAddress').val();
				let interviewNotifications = $('#interviewNotifications').val();
				let selectedApplicantsId = $.map($('.elligibleCandidatesCheckBoxes:checked'), function(e,i) {
					return e.value;
				});
				$.ajax({
					type: 'post',
					url: `/management/applicants/generate-interview-letter`,
					data: {
						interviewDateTime,
						interviewAddress,
						interviewNotifications,
						selectedApplicantsId,
					}
				})
				.done(function(response) {

					if(response.success){
						alert(response.msg);
						location.reload();
					} else {
						alert(response.msg);
					}
				})
			})
			
			// $("#attendanceSheetForm").on('submit', function(e){
			// 	e.preventDefault();
			// 	let post = $('#post').val();
			// 	let department = $('#department').val();
			// 	$.ajax({
			// 		type: 'post',
			// 		url: `/management/applicants/download-attendance-sheet`,
			// 		data: {
			// 			post,
			// 			department,
			// 		}
			// 	})
			// 	.done(function(response) {

			// 		if(response.success){
			// 			alert(response.msg);
			// 			location.reload();
			// 		} else {
			// 			alert(response.msg);
			// 		}
			// 	})
			// })
			
			$("#sendMailForm").on('submit', function(e){
				e.preventDefault();
				let emailSubject = $('#emailSubject').val();
				let emailBody = $('#emailBody').val();
				let selectedApplicantsId = $.map($('.elligibleCandidatesCheckBoxes:checked'), function(e,i) {
					return e.value;
				});
				$.ajax({
					type: 'post',
					url: `/management/applicants/send-email`,
					data: {
						emailSubject,
						emailBody,
						selectedApplicantsId,
					}
				})
				.done(function(response) {

					if(response.success){
						alert(response.msg);
						location.reload();
					} else {
						alert(response.msg);
					}
				})
			})
			
		</script>


	</body>
</html>